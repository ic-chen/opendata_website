<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- Primary Meta Tags -->
    <title>匯率走勢查詢</title>
    <meta name="title" content="匯率走勢查詢">
    <meta name="description" content="簡易的匯率走勢查詢網頁，資料來源為「政府資料開放平台」。">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://metatags.io/">
    <meta property="og:title" content="匯率走勢查詢">
    <meta property="og:description" content="簡易的匯率走勢查詢網頁，資料來源為「政府資料開放平台」。">
    <meta property="og:image" content="https://metatags.io/assets/meta-tags-16a33a6a8531e519cc0936fbba0ad904e52d35f34a46c97a2c9f6f7dd7d336f2.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://metatags.io/">
    <meta property="twitter:title" content="匯率走勢查詢">
    <meta property="twitter:description" content="簡易的匯率走勢查詢網頁，資料來源為「政府資料開放平台」。">
    <meta property="twitter:image" content="https://metatags.io/assets/meta-tags-16a33a6a8531e519cc0936fbba0ad904e52d35f34a46c97a2c9f6f7dd7d336f2.png">

    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/bootstrap.css">
    <link rel="stylesheet" href="./css/all.css">
    <link rel="stylesheet" href="./css/main.css">
    <style>
    </style>
</head>

<body class="bg-gray" style="padding-top: 70px">

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-white">
    <a class="navbar-brand" href="#">
        <img src="./img/favicon.ico" width="30" height="30" alt="回頂端">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            快速前往
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="#usdtwd">USD > TWD</a>
            <a class="dropdown-item" href="#cnytwd">CNY > TWD</a>
            <a class="dropdown-item" href="#eurusd">EUR > USD</a>
            <a class="dropdown-item" href="#usdjpy">CNY > JPY</a>
            <a class="dropdown-item" href="#gbpusd">GBP > USD</a>
            <a class="dropdown-item" href="#audusd">AUD > USD</a>
            <a class="dropdown-item" href="#usdhkd">USD > HKD</a>
            <a class="dropdown-item" href="#usdcny">USD > CNY</a>
            <a class="dropdown-item" href="#usdzar">USD > ZAR</a>
            <a class="dropdown-item" href="#nzdusd">NZD > USD</a>
            </div>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#black">
                <img src="./img/black.png" width="20" height="20" alt="black">
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#white">
                <img src="./img/white.png" width="20" height="20" alt="white">
            </a>
        </li>
        </ul>
    </div>
</nav>

    <div class="container">
        <div class="row justify-content-md-center">
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            USD > TWD
                            <button type="button" data-name="usdtwd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="usdtwdTitle" class="h3"></span>
                        <canvas id="usdtwd"></canvas>
                    </div>
                  </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            CNY > TWD
                            <button type="button" data-name="cnytwd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="cnytwdTitle" class="h3"></span>
                        <canvas id="cnytwd"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            EUR > USD
                            <button type="button" data-name="eurusd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="eurusdTitle" class="h3"></span>
                        <canvas id="eurusd"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            USD > JPY
                            <button type="button" data-name="usdjpy" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="usdjpyTitle" class="h3"></span>
                        <canvas id="usdjpy"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            GBP > USD
                            <button type="button" data-name="gbpusd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="gbpusdTitle" class="h3"></span>
                        <canvas id="gbpusd"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            AUD > USD
                            <button type="button" data-name="audusd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="audusdTitle" class="h3"></span>
                        <canvas id="audusd"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            USD > HKD
                            <button type="button" data-name="usdhkd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="usdhkdTitle" class="h3"></span>
                        <canvas id="usdhkd"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            USD > CNY
                            <button type="button" data-name="usdcny" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="usdcnyTitle" class="h3"></span>
                        <canvas id="usdcny"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            USD > ZAR
                            <button type="button" data-name="usdzar" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="usdzarTitle" class="h3"></span>
                        <canvas id="usdzar"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-md-5">
                <div class="card my-3">
                    <div class="card-body">
                        <h5 class="card-title">
                            NZD > USD
                            <button type="button" data-name="nzdusd" class="btn btn-primary float-right" data-toggle="modal" data-target="#rateModal">
                            詳細資料 <i class="fas fa-angle-double-right"></i>
                            </button>
                        </h5>
                        <span id="nzdusdTitle" class="h3"></span>
                        <canvas id="nzdusd"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- 回到頂端 -->
<a href="javascript:" id="return-to-top"><i class="text-dark fas fa-chevron-circle-up"></i></a>

<!-- Modal -->
<div class="modal fade" id="rateModal" tabindex="-1" role="dialog" aria-labelledby="rateModalTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="rateModalTitle"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div id="rateTrend">
            </div>
            <br>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">日期</th>
                    <th scope="col">匯率</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
        </div>
        </div>
    </div>
</div>
    
<script src="./js/jquery-3.4.1.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script src="./js/Chart.min.js"></script>
<script>
$(function() {

    // ===== Scroll to Top ==== 
    $(window).scroll(function() {
        if ($(this).scrollTop() >= 50) {        // If page is scrolled more than 50px
            $('#return-to-top').fadeIn(200);    // Fade in the arrow
        } else {
            $('#return-to-top').fadeOut(200);   // Else fade out the arrow
        }
    });

    // 回頂端
    $('img[alt="回頂端"], #return-to-top').click(function() {
        $('body,html').animate({
            scrollTop : 0
        }, 200);
    })

    // 白 -> 黑
    $('img[alt="black"]').on('click', function() {
        $('nav.navbar').removeClass('navbar-light bg-white').addClass('navbar-dark bg-dark')
        $('body').removeClass('bg-gray').addClass('bg-dark')

        $('div.card').css({'background-color': '#003567', 'color': '#fff'})
        $('button.float-right').removeClass('btn-primary').addClass('btn-secondary')

        $('.modal-content').css({'background-color': '#003567', 'color': '#fff'})
        $('.modal table').addClass('table-dark')
        $('span[aria-hidden="true"]').css({'color': '#fff', 'text-shadow': '0 1px 0 #000'})

        $('#return-to-top i').removeClass('text-dark').addClass('text-secondary')
    })

    // 黑 -> 白
    $('img[alt="white"]').on('click', function() {
        $('nav.navbar').removeClass('navbar-dark bg-dark').addClass('navbar-light bg-white')
        $('body').removeClass('bg-dark').addClass('bg-gray')

        $('div.card').css({'background-color': '#fff', 'color': '#003567'})
        $('button.float-right').removeClass('btn-secondary').addClass('btn-primary')

        $('.modal-content').css({'background-color': '#fff', 'color': '#212529'})
        $('.modal table').removeClass('table-dark')
        $('span[aria-hidden="true"]').css({'color': '#000', 'text-shadow': '0 1px 0 #fff'})

        $('#return-to-top i').removeClass('text-secondary').addClass('text-dark')
    })

    let url = 'https://quality.data.gov.tw/dq_download_json.php?nid=11339&md5_url=f2fdbc21603c55b11aead08c84184b8f'
    $.post('./api/opendata_api.php', {url}, function(jsonData) {
        let data = JSON.parse(jsonData)
        let len = data.length

        // console.log(data)

        // 最新匯率
        $('#usdtwdTitle').text(data[(data.length)-1]['美元／新台幣'])
        $('#cnytwdTitle').text(data[(data.length)-1]['人民幣／新台幣'])
        $('#eurusdTitle').text(data[(data.length)-1]['歐元／美元'])
        $('#usdjpyTitle').text(data[(data.length)-1]['美元／日幣'])
        $('#gbpusdTitle').text(data[(data.length)-1]['英鎊／美元'])
        $('#audusdTitle').text(data[(data.length)-1]['澳幣／美元'])
        $('#usdhkdTitle').text(data[(data.length)-1]['美元／港幣'])
        $('#usdcnyTitle').text(data[(data.length)-1]['美元／人民幣'])
        $('#usdzarTitle').text(data[(data.length)-1]['美元／南非幣'])
        $('#nzdusdTitle').text(data[(data.length)-1]['紐幣／美元'])

        // 歷史匯率
        let dateList = []
        let usdtwdList = []
        let cnytwdList = []
        let eurusdList = []
        let usdjpyList = []
        let gbpusdList = []
        let audusdList = []
        let usdhkdList = []
        let usdcnyList = []
        let usdzarList = []
        let nzdusdList = []

        data.forEach(function(content) {
            dateList.push(content.日期)
            usdtwdList.push(content['美元／新台幣'])
            cnytwdList.push(content['人民幣／新台幣'])
            eurusdList.push(content['歐元／美元'])
            usdjpyList.push(content['美元／日幣'])
            gbpusdList.push(content['英鎊／美元'])
            audusdList.push(content['澳幣／美元'])
            usdhkdList.push(content['美元／港幣'])
            usdcnyList.push(content['美元／人民幣'])
            usdzarList.push(content['美元／南非幣'])
            nzdusdList.push(content['紐幣／美元'])
        })

        rate('usdtwd', 'USD > TWD', usdtwdList)
        rate('cnytwd', 'CNY > TWD', cnytwdList)
        rate('eurusd', 'EUR > USD', eurusdList)
        rate('usdjpy', 'CNY > JPY', usdjpyList)
        rate('gbpusd', 'GBP > USD', gbpusdList)
        rate('audusd', 'AUD > USD', audusdList)
        rate('usdhkd', 'USD > HKD', usdhkdList)
        rate('usdcny', 'USD > CNY', usdcnyList)
        rate('usdzar', 'USD > ZAR', usdzarList)
        rate('nzdusd', 'NZD > USD', nzdusdList)

        // 匯率折線圖函式
        function rate(canvasID, labelName, dollarList) {
            let line = document.getElementById(canvasID).getContext('2d')
            let gradientStroke = line.createLinearGradient(0, 0, 500, 0)
            gradientStroke.addColorStop(0.1, '#e91e63')
            gradientStroke.addColorStop(0.6, '#86A8E7')
            gradientStroke.addColorStop(1, '#5FFBF1')

            let myLineChart = new Chart(line, {
                type: 'line',
                data: {
                    labels: dateList,
                    datasets: [{
                        label: labelName, 
                        data: dollarList,

                        borderColor: gradientStroke,
                        pointBorderColor: gradientStroke,
                        pointBackgroundColor: gradientStroke,
                        pointHoverBackgroundColor: gradientStroke,
                        pointHoverBorderColor: gradientStroke,

                        fill: false,
                        borderWidth: 5,
                        // lineTension: 0
                    }]
                },
                options: {
                    // title: {
                    //     text: 'USD -> TWD',
                    //     display: true
                    // },
                    scales: {
                        xAxes: [{
                            display: false
                        }],
                        yAxes: [{
                            display: false
                        }]
                    },
                    legend: {
                        display: false
                    },
                    elements: {
                        point:{
                            radius: 0
                        }
                    }
                }
            })
        }

        // ---------------- Modal 顯示詳細匯率資訊 ------------------ //
        $('button.float-right').on('click',function(){
            let name
            switch($(this).attr('data-name')) {
                case 'usdtwd':
                name = 'USD > TWD'
                rateTitle(name)
                modalRate(name, usdtwdList)
                fillRate('美元／新台幣')
                break;
                case 'cnytwd':
                name = 'CNY > TWD'
                rateTitle(name)
                modalRate(name, cnytwdList)
                fillRate('人民幣／新台幣')
                break;
                case 'eurusd':
                name = 'EUR > USD'
                rateTitle(name)
                modalRate(name, eurusdList)
                fillRate('歐元／美元')
                break;
                case 'usdjpy':
                name = 'USD > JPY'
                rateTitle(name)
                modalRate(name, usdjpyList)
                fillRate('美元／日幣')
                break;
                case 'gbpusd':
                name = 'GBP > USD'
                rateTitle(name)
                modalRate(name, gbpusdList)
                fillRate('英鎊／美元')
                break;
                case 'audusd':
                name = 'AUD > USD'
                rateTitle(name)
                modalRate(name, audusdList)
                fillRate('澳幣／美元')
                break;
                case 'usdhkd':
                name = 'USD > HKD'
                rateTitle(name)
                modalRate(name, usdhkdList)
                fillRate('美元／港幣')
                break;
                case 'usdcny':
                name = 'USD > CNY'
                rateTitle(name)
                modalRate(name, usdcnyList)
                fillRate('美元／人民幣')
                break;
                case 'usdzar':
                name = 'USD > ZAR'
                rateTitle(name)
                modalRate(name, usdzarList)
                fillRate('美元／南非幣')
                break;
                case 'nzdusd':
                name = 'NZD > USD'
                rateTitle(name)
                modalRate(name, nzdusdList)
                fillRate('紐幣／美元')
                break;
                default:
                break;
            }

            // 標題
            function rateTitle(txt) {
                $('#rateModalTitle').empty()
                $('#rateModalTitle').text(txt)
            }

            // 在表格中填入匯率
            function fillRate(dollar) {
                $('tbody').empty()
                data.forEach(function(res) {
                    $('tbody').append(
                    `<tr>
                    <td>${res.日期}</td>
                    <td>${res[dollar]}</td>
                    </tr>`
                    )
                })
            }

            function modalRate(labelsName, dollarsList) {
                $('#rateTrend').empty()
                $('#rateTrend').append(
                    `<canvas id="rateTrendCanvas"></canvas>`
                )
                let modalLine = document.getElementById('rateTrendCanvas').getContext('2d')
                let gradientStroke2 = modalLine.createLinearGradient(0, 0, 750, 0)
                gradientStroke2.addColorStop(0.2, '#e91e63')
                gradientStroke2.addColorStop(0.7, '#86A8E7')
                gradientStroke2.addColorStop(1, '#5FFBF1')

                if($('.modal table').hasClass('table-dark')) {
                    Chart.defaults.global.defaultFontColor = '#fff'
                }else{
                    Chart.defaults.global.defaultFontColor = '#666'
                }

                Chart.defaults.scale.gridLines.color = gradientStroke2

                let myLineChart = new Chart(modalLine, {
                    type: 'line',
                    data: {
                        labels: dateList,
                        datasets: [{
                            label: labelsName, 
                            data: dollarsList,

                            borderColor: gradientStroke2,
                            pointBorderColor: gradientStroke2,
                            pointBackgroundColor: gradientStroke2,
                            pointHoverBackgroundColor: gradientStroke2,
                            pointHoverBorderColor: gradientStroke2,

                            fill: false,
                            borderWidth: 5,
                        }]
                    },
                    options: {
                        legend: {
                            display: false
                        },
                    }
                })

            }
        })

    })
})
</script>
</body>
</html>